{"version":3,"file":"pageConverter.js","sourceRoot":"","sources":["../../../src/node/plugins/pageConverter.ts"],"names":[],"mappings":"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","sourcesContent":["import { type App, type Page, type PluginObject } from \"@vuepress/core\";\nimport { isPlainObject } from \"@vuepress/shared\";\nimport { injectLocalizedDate, keys, startsWith } from \"vuepress-shared/node\";\n\nimport {\n  ArticleInfoType,\n  PageType,\n  type ThemeBlogHomePageFrontmatter,\n  type ThemeData,\n  type ThemeNormalPageFrontmatter,\n  type ThemePageData,\n  type ThemeProjectHomePageFrontmatter,\n} from \"../../shared/index.js\";\nimport { convertFrontmatter } from \"../compact/index.js\";\nimport { checkFrontmatter } from \"../frontmatter/check.js\";\n\nexport const injectPageInfo = (page: Page<ThemePageData>): void => {\n  const { filePathRelative } = page;\n  const frontmatter = page.frontmatter as\n    | ThemeProjectHomePageFrontmatter\n    | ThemeBlogHomePageFrontmatter\n    | ThemeNormalPageFrontmatter;\n\n  const isArticle =\n    // declaring this is an article\n    frontmatter.article ||\n    // generated from markdown files\n    Boolean(frontmatter.article !== false && filePathRelative);\n  const isSlide = frontmatter.layout === \"Slide\";\n\n  // save page type to routeMeta\n  page.routeMeta[ArticleInfoType.type] = frontmatter.home\n    ? PageType.home\n    : isSlide\n    ? PageType.slide\n    : isArticle\n    ? PageType.article\n    : PageType.page;\n\n  // save relative file path into page data to generate edit link\n  page.data.filePathRelative = filePathRelative;\n\n  page.routeMeta[ArticleInfoType.title] = page.title;\n\n  if (\"icon\" in frontmatter)\n    page.routeMeta[ArticleInfoType.icon] = frontmatter.icon;\n\n  // catalog related\n  if (isPlainObject(frontmatter.dir)) {\n    if (\"order\" in frontmatter.dir)\n      page.routeMeta[ArticleInfoType.order] = (\n        frontmatter as ThemeNormalPageFrontmatter\n      ).dir!.order;\n\n    if (\n      \"index\" in frontmatter.dir &&\n      (frontmatter as ThemeNormalPageFrontmatter).dir!.index === false\n    )\n      page.routeMeta[ArticleInfoType.index] = 0;\n  } else {\n    if (\"order\" in frontmatter)\n      page.routeMeta[ArticleInfoType.order] = frontmatter.order;\n    if (\"index\" in frontmatter && frontmatter.index === false)\n      page.routeMeta[ArticleInfoType.index] = 0;\n  }\n\n  // resolve shortTitle\n  if (\"shortTitle\" in frontmatter)\n    page.routeMeta[ArticleInfoType.shortTitle] = frontmatter.shortTitle;\n};\n\nexport const extendsPagePlugin = (\n  themeData: ThemeData,\n  legacy = true\n): PluginObject => {\n  const encryptedPaths = keys(themeData.encrypt.config || {});\n  const isPageEncrypted = ({ path }: Page): boolean =>\n    encryptedPaths.some((key) => startsWith(decodeURI(path), key));\n\n  return {\n    name: \"vuepress-theme-hope-extends-page\",\n\n    extendsPage: (page, app): void => {\n      if (legacy)\n        page.frontmatter = convertFrontmatter(\n          page.frontmatter,\n          page.filePathRelative || \"\"\n        );\n\n      const isEncrypted = isPageEncrypted(page);\n\n      // encrypt page shall not have seo\n      if (isEncrypted) page.frontmatter[\"seo\"] = false;\n\n      checkFrontmatter(page, app.env.isDebug);\n      injectPageInfo(<Page<ThemePageData>>page);\n      injectLocalizedDate(page);\n    },\n  };\n};\n\nexport const useExtendsPagePlugin = (\n  app: App,\n  themeData: ThemeData,\n  legacy = true\n): void => {\n  app.use(extendsPagePlugin(themeData, legacy));\n};\n"]}